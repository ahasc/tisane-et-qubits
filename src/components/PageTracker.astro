---
// PageTracker - Enregistre automatiquement les vues de pages dans Back4App
const isProduction = import.meta.env.PROD;
---

<script define:vars={{ isProduction }}>
  // Fonction pour enregistrer une vue de page
  async function trackPageView() {
    // Ne tracker qu'en production
    if (!isProduction) {
      console.log('Dev mode: Page view not tracked');
      return;
    }

    try {
      // Attendre que Parse soit charg√©
      if (typeof Parse === 'undefined') {
        console.error('Parse is not loaded');
        return;
      }

      const PageView = Parse.Object.extend('PageView');
      const pageView = new PageView();

      pageView.set('page', window.location.pathname);
      pageView.set('title', document.title);

      await pageView.save();
      console.log('Page view tracked successfully');
    } catch (error) {
      console.error('Page tracking error:', error);
    }
  }

  // Enregistrer la vue au chargement
  if (document.readyState === 'complete') {
    trackPageView();
  } else {
    window.addEventListener('load', trackPageView);
  }
</script>
